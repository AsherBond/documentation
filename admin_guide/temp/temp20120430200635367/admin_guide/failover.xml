<?xml version="1.0" encoding="utf-8"?><?workdir /Users/scottb/Documents/git/documentation/admin_guide/temp/temp20120430200635367/admin_guide?><?path2project ../?><concept xmlns:ditaarch="http://dita.oasis-open.org/architecture/2005/" id="failover" ditaarch:DITAArchVersion="1.2" domains="(topic concept)                            (topic hi-d)                             (topic ut-d)                             (topic indexing-d)                            (topic hazard-d)                            (topic abbrev-d)                            (topic pr-d)                             (topic sw-d)                            (topic ui-d)    " class="- topic/topic concept/concept " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="concept:1">
 <title class="- topic/title " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="title:1">Recovering from a Fail: Walrus</title>
 <shortdesc class="- topic/shortdesc " xtrc="shortdesc:1" xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita"/>
 <prolog class="- topic/prolog "><copyright class="- topic/copyright " xtrc="copyright:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap">
			<copyryear class="- topic/copyryear " xtrc="copyryear:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap" year="2012"/>
			<copyrholder class="- topic/copyrholder " xtrc="copyrholder:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap">Eucalyptus Systems</copyrholder>
		</copyright><metadata class="- topic/metadata "><prodinfo class="- topic/prodinfo " xtrc="prodinfo:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap">
			<prodname class="- topic/prodname " xtrc="prodname:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap">Eucalyptus</prodname>
			<vrmlist class="- topic/vrmlist " xtrc="vrmlist:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap">
				<vrm class="- topic/vrm " version="3.0" xtrc="vrm:1" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap"/>
			</vrmlist>
		</prodinfo></metadata></prolog><conbody class="- topic/body  concept/conbody " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="conbody:1">
 	
 	<p class="- topic/p " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="p:1">In these examples, we will assume that Walrus <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:1">WS00</codeph> is the primary and <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:2">WS01</codeph> is the secondary Walrus server.</p>
 	<section class="- topic/section " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="section:1">
 		<title class="- topic/title " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="title:2">Software Failure Example</title>
 	
 	
 	<p class="- topic/p " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="p:2">In this scenario, <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:3">WS01</codeph> refuses to go to <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:4">DISABLED</codeph> state. DRBD complains that it is in split brain mode. <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:5">drbdadm cstate r0</codeph> shows that DRBD is in WFConnection state.</p>
 	
 	<p class="- topic/p " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="p:3">If you are sure that data on <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:6">WS01</codeph> is out of date and can be discarded, execute
 		the following commands to restore HA mode.</p>
 	<ol class="- topic/ol " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="ol:1">
 	<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:1">Shut down the eucalyptus-cloud process on WS01.</li>
 	
 	<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:2">Ensure that the DRBD connection is down by typing "drbdadm disconnect r0" on any of the two Walrus hosts.</li>
 	
 	<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:3">On the primary Walrus, WS00, set drbd as the primary by executing "drbdadm primary r0"</li>
 	
 <li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:4">	On the secondary Walrus, WS01, execute the following command:
 <codeblock xml:space="preserve" class="+ topic/pre pr-d/codeblock " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeblock:1">drbdadm -- --discard-my-data connect</codeblock>
 	<note type="warning" class="- topic/note " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="note:1">This command will discard all data on WS01 and synchronize data from WS00.</note>
 </li>
 
 	
 	<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:5">Monitor the state of DRBD by running:
 	<codeblock xml:space="preserve" class="+ topic/pre pr-d/codeblock " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeblock:2">watch -n 2 cat /proc/drbd</codeblock></li>
 	
 	<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:6">When the data on WS01 is synced, start the eucalyptus-cloud process on WS01.</li>
 	</ol>
 	</section>
 	
 	<section class="- topic/section " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="section:2">
 		<title class="- topic/title " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="title:3">Hardware Failure Example</title>
 		<p class="- topic/p " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="p:4">In this example, the primary <codeph class="+ topic/ph pr-d/codeph " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeph:7">WS00</codeph> needs to be taken out of service due to a
 		hardware failure, such as a failed disk.</p>
 		<ol class="- topic/ol " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="ol:2">
 			<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:7">Shut down the eucalyptus-cloud process on WS00 if it is still running.</li>
 			
 			<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:8">Monitor service status by running <cmdname class="+ topic/keyword sw-d/cmdname " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="cmdname:1">euca-describe-services</cmdname> on WS01 and ensure that WS01 has taken over as the new primary (state: ENABLED).</li>
 			
 			<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:9">Shut down the host running WS00.</li>
 			
 			<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:10">If the host running WS00 is to be replaced entirely or the OS reinstalled:
 			<ul class="- topic/ul " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="ul:1">
 			<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:11">On the primary CLC, enter the following to deregister WS00:
 				<codeblock xml:space="preserve" class="+ topic/pre pr-d/codeblock " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeblock:3">euca_conf --deregister-walrus --component WS00 partition &lt;name of partition&gt;
 					--host &lt;WS00 host&gt;</codeblock>
 				</li>
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:12">After Linux has been installed on the new WS00 host and it is ready for use, please reinstall the "eucalyptus-walrus" package.</li>
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:13">Synchronize the DRBD configuration (/etc/drbd.conf and /etc/eucalyptus/drbd*) from the WS01 host.</li>
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:14">On WS00, re-configure DRBD by following the Configure DRBD section of the Installation Guide and performing the steps that are relevant to the secondary Walrus server (WS00 is the new secondary Walrus server, in this example).</li>
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:15">Re-register WS00 with a new host name if necessary. This will synchronize keys.</li>
 			</ul>
 			</li>
 				
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:16">On WS00, execute the following command:
 				
 				<codeblock xml:space="preserve" class="+ topic/pre pr-d/codeblock " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeblock:4">drbdadm -- --discard-my-data connect</codeblock>
 				
 				<note type="warning" class="- topic/note " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="note:2">This command will discard all data on WS00 and synchronize data from WS01.</note>
 				</li>
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:17">Monitor the state of DRBD by entering:
 					<codeblock xml:space="preserve" class="+ topic/pre pr-d/codeblock " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="codeblock:5">watch -n 2 cat /proc/drbd</codeblock>
 					<p class="- topic/p " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="p:5">WS01 should be marked as the primary and WS00 is the new secondary. Wait until data is synchronized.</p>
 				</li>

 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:18">When the data on WS00 is synced from WS01, start the eucalyptus-cloud process on WS00.</li>
 				
 			
 				
 				<li class="- topic/li " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="li:19">Monitor service status by running "euca-describe-services" on the primary CLC and ensure that WS00 is DISABLED and WS01 is ENABLED.</li>
 		</ol>
 				<p class="- topic/p " xtrf="/Users/scottb/Documents/git/documentation/admin_guide/failover.dita" xtrc="p:6">At this point, the Walrus service is back in HA mode.</p>
 		
 		
 		
 	</section>
 
 	
  
 </conbody>
<related-links class="- topic/related-links "><linkpool class="- topic/linkpool " xtrc="topicref:146" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap"><link class="- topic/link " mapclass="- map/topicref " type="concept" xtrc="topicref:134" xtrf="/Users/scottb/Documents/git/documentation/ag.ditamap" href="../admin_guide/appendix.xml" role="parent"><?ditaot usertext?><linktext class="- topic/linktext "><?ditaot gentext?>Appendix</linktext><?ditaot genshortdesc?><desc class="- topic/desc "/></link></linkpool></related-links>
</concept>